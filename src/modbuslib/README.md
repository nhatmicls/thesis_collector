# Modbuslib
Code snippets for PoC of stuff running on Raspberry PI

## Requirements

- Python 3.9
- pySerial
- modbus-tk

## Verifying the Modbuslib Installation

Command:
```
python -m unittest discover -v modbuslib
```

Expected result:
```
test_read_covert_multi_rawdata_to_human_readable_data (modbuslib.test.test_modbuslib.test_connection) ... 
Modbus simulate starting
Modbus simulate running
Modbus simulate add slave completed with ID: 1
Modbus simulate stop
ok
test_read_covert_rawdata_to_human_readable_data (modbuslib.test.test_modbuslib.test_connection) ... 
Modbus simulate starting
Modbus simulate running
Modbus simulate add slave completed with ID: 1
Modbus simulate stop
ok
test_LittleEndian_data_to_BigEndian_data_byteOrder (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_LittleEndian_data_to_BigEndian_data_wordOrder (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc64 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_bitfield16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_enum16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_enum32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_float (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int64 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_string (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_uint16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_uint32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_multi_data_to_single_data (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_wrap_return_data (modbuslib.test.test_modbuslib.test_data_processor) ... ok

----------------------------------------------------------------------
Ran 19 tests in 1.527s

OK
```
# For developer 

## Flow program

## modbus_lib.py

This file will store all function to get and process data for modbus device.

- class `ModbusDecoder`: Linker between specify decoder for user to main process.

- class `DefaultDecoder` and `DatabaseDecoder`: store decoder for specific uses (for humand readable and database readable (Prometheus))

- class `ModbusDevice`: this is main process of program.
    - `replace_spec_character`: 

    - `wrap_return_data`:

    - `process_multi_data`:

    - `process_data`:

    - `read_raw_values`:

    - `read_raw_value`:

    - `read_values`:

    - `close_modbus`:

## compress_data.py

This file will store all function to convert data to Protocol Buffers format and compress data using snappy.

- class `CompressData`:
    - `create_new_metric_submission`:

    - `add_new_metrics_group`:

    - `add_metric_data`:

    - `compress_data`:

    - `remove_all_metric_data`:

## exceptions.py

This file will store all exception in modbuslib.

- `UnimplementedRegister`:

- `UnknownDataType`:

- `WrongInput`:

- `MissingInput`:

- `ClientIDAlreadyInitialized`:

- `ClientIDNotFound`:

## natsio_schema_pb2.py

Protocol Buffers is a free and open-source cross-platform data format used to serialize structured data. 

This file will store Protocol Buffers data format.

**This file generated by the protocol buffer compiler. DO NOT EDIT!**

If you need to edit for specific uses read [this](#note2)

Note 1: This file is generate from `natsio_schema.proto` file.

<a name="note2">
Note 2: Read this for more info <a href="https://developers.google.com/protocol-buffers/docs/pythontutorial">link</a>
</a>

# For tester

Run this command:
``` bash
python -m unittest discover -v modbuslib
```

Expected result:
``` bash
test_read_covert_multi_rawdata_to_human_readable_data (modbuslib.test.test_modbuslib.test_connection) ... 
Modbus simulate starting
Modbus simulate running
Modbus simulate add slave completed with ID: 1
Modbus simulate stop
ok
test_read_covert_rawdata_to_human_readable_data (modbuslib.test.test_modbuslib.test_connection) ... 
Modbus simulate starting
Modbus simulate running
Modbus simulate add slave completed with ID: 1
Modbus simulate stop
ok
test_LittleEndian_data_to_BigEndian_data_byteOrder (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_LittleEndian_data_to_BigEndian_data_wordOrder (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_acc64 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_bitfield16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_enum16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_enum32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_float (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_int64 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_string (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_uint16 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_data_to_uint32 (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_multi_data_to_single_data (modbuslib.test.test_modbuslib.test_data_processor) ... ok
test_wrap_return_data (modbuslib.test.test_modbuslib.test_data_processor) ... ok

----------------------------------------------------------------------
Ran 19 tests in 1.527s

OK
```